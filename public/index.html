<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>Norwegian Kosher List</title>

    <!-- Firebase App is always required and must be first -->

    <!-- Uncomment for production, comment for local development. -->
    <!-- <script defer src="/__/firebase/5.7.1/firebase-app.js"></script> -->
    <!-- <script defer src="/__/firebase/5.7.1/firebase-firestore.js"></script> -->

    <!-- Uncomment for local development, comment for production. -->
    <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.7.1/firebase-firestore.js"></script>

    <!-- include only the Firebase features as you need -->
    <!-- <script defer src="/__/firebase/5.7.1/firebase-auth.js"></script> -->
    <!-- <script defer src="/__/firebase/5.7.1/firebase-messaging.js"></script> -->

    <!-- initialize the SDK after all desired features are loaded -->
    <!-- Uncomment for production, comment for local development. -->
    <!-- <script defer src="/__/firebase/init.js"></script> -->

    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="header">
        <h1 class="header__topline">
            Norwegian Kosher List
            <span id="info_modal__open" class="info_modal__open"></span>
        </h1>

        <!-- The Modal -->
        <div id="info_modal" class="info_modal">
            <!-- Modal content -->
            <div class="info_modal__content">
                <span class="info_modal__close">&times;</span>
                <p>Some text in the Modal..</p>
            </div>
        </div>

        <p class="info" id="metadata"></p>
        <p class="info">To search, write a text and press enter</p>
    </div>
    <div id="searchBar"></div>
    <div id="products"></div>

    <script type="module">
        import {data} from "./data.js";
        import * as view from "./mainView.js";
        import * as database from "./kappDb.js";

        function getQueryData() {
            let kv;
            return location.search.slice(1).split("&").reduce((acc, curr) => {
                kv = curr.split("=");
                acc[kv[0]] = kv[1];
                return acc;
            }, {});
        }

        document.addEventListener('DOMContentLoaded', function () {
            const query = getQueryData()

            console.log(data["metadata"]);
            console.log("query", query);

            const db = database.init(data);
            db.initLocalDb()
                .then((ready) => {
                    view.init(db, query.id, query.showids);
                });
        });

        function initFirestore(firebase) {
            const config = {
                projectId: "kappdb-6fb1e",
            };

            // Only call this when developing on local machine.
            if (window.location.hostname === "") {
                firebase.initializeApp(config);
            }

            // Initialize Cloud Firestore through Firebase
            const db = firebase.firestore();

            // Disable deprecated features
            db.settings({
                timestampsInSnapshots: true
            });

            return db;
        }
    </script>

</body>

</html>